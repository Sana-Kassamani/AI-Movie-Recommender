<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stopwatch Example</title>
  </head>
  <body>
    <!-- Table Element -->
    <table id="myTable">
      <tr>
        <td>Row 1</td>
      </tr>
      <tr>
        <td>Row 2</td>
      </tr>
    </table>

    <!-- Stop Button -->
    <button id="backButton">Stop Stopwatch</button>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"
      integrity="sha512-DdX/YwF5e41Ok+AI81HI8f5/5UsoxCVT9GKYZRIzpLxb8Twz4ZwPPX+jQMwMhNQ9b5+zDEefc+dcvQoPWGNZ3g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      let startTime; // Store the start time
      let elapsedTime = 0; // Store elapsed time when stopped
      let isRunning = false; // State of the stopwatch
      //let time_spent_cst = 0;
      // Start the stopwatch when the table is loaded
      const table = document.getElementById("myTable");
      window.addEventListener("load", () => {
        
        startStopwatch();
        
      });

      // Function to start the stopwatch
      function startStopwatch() {
        if (!isRunning) {
          startTime = new Date().getTime(); // Record the current time
          isRunning = true; // Set running state to true
          console.log("Stopwatch started.");
        }
      }

      // Function to stop the stopwatch and log the final time
      function backStopwatch() {
        if (isRunning) {
          const now = new Date().getTime();
          elapsedTime = now - startTime; // Calculate elapsed time
          isRunning = false; // Set running state to false
          //elapsedTime = time_spent_cst + elapsedTime;
          console.log(`Stopwatch stopped. Total time: ${elapsedTime} ms`);

          const data = new FormData();
          data.append("user_id", 2);
          data.append("movie_id", 9);
          data.append("time_spent", elapsedTime);

          axios(
            "http://localhost/AI-Movie-Recommender/server-side/updateActivity.php",
            {
              method: "POST",
              data: data,
            }
          )
            .then((response) => {
              console.log("time and clicks updated");
            })
            .catch((error) => {
              console.log("error getting insidghts");
            });
        }
      }

      // Add event listener to the button
      const backButton = document.getElementById("backButton");
      backButton.addEventListener("click", backStopwatch);
    </script>
  </body>
</html>
